<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>çƒå‘˜æ•°æ®ç®¡ç†ï¼ˆè‡ªå®šä¹‰å¯¼å‡ºåï¼‰</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
      background: #f5f7fa;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 16px;
      color: #2c3e50;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.2s;
    }
    #reset-all { background: #e74c3c; }
    #export-btn { background: #2ecc71; }
    button:hover { opacity: 0.9; }
    #reset-all:hover { background: #c0392b; }
    #export-btn:hover { background: #27ae60; }

    .players-container {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }
    .player-card {
      background: white;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      position: relative;
    }
    .delete-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #e74c3c;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
      border: none;
      color: white;
    }
    .delete-btn:hover { background: #c0392b; }
    .name-input {
      width: 100%;
      padding: 8px;
      margin-bottom: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    .plus-minus {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      margin: 12px 0;
      color: #27ae60;
      background: #e8f5e9;
      padding: 8px;
      border-radius: 6px;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0;
    }
    .stat-label {
      font-size: 14px;
      color: #555;
      flex: 1;
    }
    .stat-value {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .value-display {
      min-width: 30px;
      text-align: center;
      font-weight: bold;
      background: #f8f9fa;
      padding: 4px 8px;
      border-radius: 4px;
    }
    .btn-inc, .btn-dec {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #95a5a6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-inc:hover { background: #7f8c8d; }
    .btn-dec:hover { background: #7f8c8d; }
  </style>
</head>
<body>

  <h1>ğŸ€ çƒå‘˜æ•°æ®ç®¡ç†ï¼ˆè‡ªå®šä¹‰å¯¼å‡ºåï¼‰</h1>

  <div class="controls">
    <button id="add-player">â• æ·»åŠ çƒå‘˜</button>
    <button id="reset-all">ğŸ”„ é‡ç½®æ‰€æœ‰</button>
    <button id="export-btn">ğŸ“¥ å¯¼å‡º CSV</button>
  </div>

  <div class="players-container" id="players-container">
    <!-- çƒå‘˜å¡ç‰‡å°†åŠ¨æ€æ’å…¥æ­¤å¤„ -->
  </div>

  <script>
    let players = [];
    let nextId = 1;

    const container = document.getElementById('players-container');
    const addButton = document.getElementById('add-player');
    const resetButton = document.getElementById('reset-all');
    const exportButton = document.getElementById('export-btn');

    function init() {
      addPlayer();
    }

    function addPlayer() {
      const id = nextId++;
      players.push({
        id,
        name: 'æ–°çƒå‘˜',
        stats: {
          '3pa': 0, '3pm': 0,
          '2pa': 0, '2pm': 0,
          'reb': 0, 'ast': 0,
          'to': 0, 'pf': 0,
          'stl': 0, 'blk': 0,
          'fta': 0, 'ftm': 0
        },
        plusMinus: 0
      });
      updateUI();
    }

    function deletePlayer(id) {
      players = players.filter(p => p.id !== id);
      updateUI();
    }

    function updatePlayerName(id, name) {
      const player = players.find(p => p.id === id);
      if (player) player.name = name;
    }

    function calculatePlusMinus(stats) {
      return (
        stats['3pa'] * (-1) +
        stats['2pa'] * (-1) +
        stats['3pm'] * 3 +
        stats['2pm'] * 2 +
        stats['reb'] * 2 +
        stats['ast'] * 2 +
        stats['to'] * (-2) +
        stats['pf'] * (-1) +
        stats['stl'] * 2 +
        stats['blk'] * 2 +
        stats['ftm'] * 1
      );
    }

    function adjustStat(id, key, delta) {
      const player = players.find(p => p.id === id);
      if (!player) return;
      const newValue = player.stats[key] + delta;
      if (newValue >= 0) {
        player.stats[key] = newValue;
        player.plusMinus = calculatePlusMinus(player.stats);
        updateUI();
      }
    }

    function resetPlayer(id) {
      const player = players.find(p => p.id === id);
      if (player) {
        player.stats = {
          '3pa': 0, '3pm': 0,
          '2pa': 0, '2pm': 0,
          'reb': 0, 'ast': 0,
          'to': 0, 'pf': 0,
          'stl': 0, 'blk': 0,
          'fta': 0, 'ftm': 0
        };
        player.plusMinus = 0;
      }
    }

    function resetAllPlayers() {
      players.forEach(p => resetPlayer(p.id));
      updateUI();
    }

    // âœ… æ–°å¢ï¼šæ”¯æŒè‡ªå®šä¹‰æ–‡ä»¶åå¯¼å‡º
    function exportToCSV() {
      if (players.length === 0) {
        alert('æš‚æ— çƒå‘˜æ•°æ®å¯å¯¼å‡ºï¼');
        return;
      }

      // é»˜è®¤æ–‡ä»¶åï¼ˆå¸¦æ—¥æœŸï¼‰
      const defaultName = `çƒå‘˜æ•°æ®_${new Date().toISOString().slice(0, 10).replace(/-/g, '')}`;

      // å¼¹å‡ºè¾“å…¥æ¡†ï¼Œè®©ç”¨æˆ·è‡ªå®šä¹‰
      let fileName = prompt('è¯·è¾“å…¥å¯¼å‡ºçš„æ–‡ä»¶åï¼ˆä¸å« .csvï¼‰ï¼š', defaultName);

      // ç”¨æˆ·å–æ¶ˆæˆ–è¾“å…¥ç©ºå€¼
      if (fileName === null || fileName.trim() === '') {
        return; // å–æ¶ˆå¯¼å‡º
      }

      // æ¸…ç†éæ³•å­—ç¬¦ï¼ˆWindows ä¸å…è®¸çš„å­—ç¬¦ï¼‰
      fileName = fileName.replace(/[<>:"/\\|?*\x00-\x1F]/g, '_').trim();
      if (fileName === '') fileName = 'çƒå‘˜æ•°æ®';

      // è¡¨å¤´
      const headers = [
        'çƒå‘˜å§“å',
        'ä¸‰åˆ†å‡ºæ‰‹', 'ä¸‰åˆ†å‘½ä¸­',
        'ä¸¤åˆ†å‡ºæ‰‹', 'ä¸¤åˆ†å‘½ä¸­',
        'ç¯®æ¿', 'åŠ©æ”»',
        'å¤±è¯¯', 'çŠ¯è§„',
        'æŠ¢æ–­', 'å°ç›–',
        'ç½šçƒå‡ºæ‰‹', 'ç½šçƒå‘½ä¸­',
        'æ­£è´Ÿå€¼'
      ];

      // æ•°æ®è¡Œ
      const rows = players.map(p => [
        `"${p.name.replace(/"/g, '""')}"`,
        p.stats['3pa'], p.stats['3pm'],
        p.stats['2pa'], p.stats['2pm'],
        p.stats['reb'], p.stats['ast'],
        p.stats['to'], p.stats['pf'],
        p.stats['stl'], p.stats['blk'],
        p.stats['fta'], p.stats['ftm'],
        p.plusMinus
      ]);

      let csvContent = headers.join(',') + '\n';
      csvContent += rows.map(row => row.join(',')).join('\n');

      const bom = '\uFEFF';
      const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = fileName + '.csv'; // âœ… è‡ªå®šä¹‰æ–‡ä»¶å + .csv

      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function updateUI() {
      let html = '';
      players.forEach(player => {
        const pm = player.plusMinus;
        const pmColor = pm >= 0 ? '#27ae60' : '#e74c3c';
        const pmText = pm >= 0 ? `+${pm}` : `${pm}`;

        let cardHtml = `
          <div class="player-card" data-id="${player.id}">
            <button class="delete-btn" onclick="deletePlayer(${player.id})">Ã—</button>
            <input type="text" class="name-input" value="${player.name}" oninput="updatePlayerName(${player.id}, this.value)">
            <div class="plus-minus" style="color:${pmColor};">${pmText}</div>
        `;
        const stats = [
          ['ä¸‰åˆ†å‡ºæ‰‹', '3pa'],
          ['ä¸‰åˆ†å‘½ä¸­', '3pm'],
          ['ä¸¤åˆ†å‡ºæ‰‹', '2pa'],
          ['ä¸¤åˆ†å‘½ä¸­', '2pm'],
          ['ç¯®æ¿', 'reb'],
          ['åŠ©æ”»', 'ast'],
          ['å¤±è¯¯', 'to'],
          ['çŠ¯è§„', 'pf'],
          ['æŠ¢æ–­', 'stl'],
          ['å°ç›–', 'blk'],
          ['ç½šçƒå‡ºæ‰‹', 'fta'],
          ['ç½šçƒå‘½ä¸­', 'ftm']
        ];
        stats.forEach(([label, key]) => {
          const value = player.stats[key];
          cardHtml += `
            <div class="stat-row">
              <span class="stat-label">${label}</span>
              <div class="stat-value">
                <button class="btn-dec" onclick="adjustStat(${player.id}, '${key}', -1)">âˆ’</button>
                <span class="value-display">${value}</span>
                <button class="btn-inc" onclick="adjustStat(${player.id}, '${key}', 1)">+</button>
              </div>
            </div>
          `;
        });
        cardHtml += '</div>';
        html += cardHtml;
      });
      container.innerHTML = html;
    }

    addButton.addEventListener('click', addPlayer);
    resetButton.addEventListener('click', resetAllPlayers);
    exportButton.addEventListener('click', exportToCSV);

    init();
  </script>
</body>
</html>